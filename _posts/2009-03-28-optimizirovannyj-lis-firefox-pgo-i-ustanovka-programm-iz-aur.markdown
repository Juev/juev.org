--- 
layout: post
title: !binary |
  0J7Qv9GC0LjQvNC40LfQuNGA0L7QstCw0L3QvdGL0Lkg0LvQuNGBIC0gZmly
  ZWZveC1wZ28g0Lgg0YPRgdGC0LDQvdC+0LLQutCwINC/0YDQvtCz0YDQsNC8
  0Lwg0LjQtyBBVVI=

---
Сегодня меня заинтересовал вопрос оптимизации огнелиса. Во всех статьях, что встретил в интернете описывается только изменение настроек профиля (время ожидания перед прорисовкой страницы, изменение требуемого объема памяти и тому подобное).

Но меня больше всего интересовал вопрос оптимизации непосредственно самого бинарника. Что произойдет, если его собрать с оптимизацией под свой компьютер? Да, есть проекты, типа swiftfox, который предоставляет уже откомпилированные пакеты под определенные процессоры. Но он очень редко обновляется. И при текущей версии огнелиса в 3.0.8 в репозитории представлен swiftfox только версии 3.0.4... Не наш путь!
<!--more-->
Сделал поиск по репозиторию archlinux с использованием любимого yaourt. Он выдает результаты не только из репозитория, но и из AUR. Как раза в AUR был обнаружен пакет <strong>firefox-pgo</strong>, который предоставляет последнюю версию огнелиса, оптимизированную под выбранную машину. При этом интерпретатор XUL ставиться вместе с огнелисом.

Предварительно нужно изменить файл <strong>/etc/makepkg.conf</strong> и прописать в нем используемую архитектуру процессора с помощью строк <strong>CFLAGS</strong> и <strong>CXXFLAGS</strong>. И задать число потоков компиляции в строке <strong>MAKEFLAGS</strong>="-j3" (вариант для двухядерного процессора).

Затем устанавливаем пакет <strong>firefox-pgo</strong> из AUR. Существует два пути:

1. Используя <strong>менеджер пакетов yaourt</strong>. Для этого используем команду:
<pre>$ yaourt -S firefox-pgo</pre>

И наблюдаем за процессом... будет автоматически скачаны исходники с сайта мозилы (порядка 34 мегабайт), затем будет проведена компиляция (уже с выбранными параметрами, у меня весь процесс занял порядка 40 минут на процессоре Core2Duo E8400) и соответственно установка (если предварительно пакет firefox был удален).

Если пакет firefox к моменту установки не был удален из системы, мы получим сообщение об ошибке. Готовый к установке пакет остается в каталоге /tmp/yaout-tmp-juev/ (в вашем случае будет другое окончание имени каталога). Достаточно будет удалить пакет firefox с помощью команды:
<pre>$ yaourt -Rdn firefox</pre>

И затем установить готовый пакет, перейдя в каталог /tmp/yaout-tmp-juev/ и дав в консоли команду:
<pre># pacman -U firefox-pgo-3.0.8-1-i686.pkg.tar.gz</pre>

2. Используя поиск в AUR. Для этого заходим в браузере на страницу AUR: http://aur.archlinux.org и делаем поиск по каталогу с помощью критерия firefox-pgo. Выбираем версию 3.0.8 и переходим на эту страницу.

В данный момент времени нас будет интересовать файл PKGBUILD, ссылка на который есть на странице. Качаем его в темповую папку домашнего каталога, затемв консоли переходим в нее и даем команду <strong>makepkg</strong>, после чего можно пойти попить чаю, пока идет компиляция... По сути происходит все то же самое, что и в случае с yaourt, только процесс заканчивается не на установке, а на сборке пакета. По завешению нужно будет этот пакет установить, используя pacman:
<pre># pacman -U firefox-pgo-3.0.8-1-i686.pkg.tar.gz</pre>

Естественно, что в этом случае firefox должен быть предварительно удален.

После установки запускаем огнелис, как обычно. И наблюдаем интерфейс на английском языке. Если необходима локализация - придется ставить расширение для огнелиса, добавляющую русскую локаль. Время запуска фактически осталось без изменений. Но, в отличие от огнелиса, установленного по умолчанию в арче, корректно открывается страница обновления огнелиса, предоставляющая информацию о текущей версии огнелиса. Мелочь - а приятно! Затем пытаемся открыть любую страницу, сразу заметна возросшая скорость отрисовки (и это без изменения профиля). При загрузке страницы gmail.com наблюдаем увеличение скорости почти на порядок! Что говорит об улучшении обработки javascript-скриптов по сравнению с арч-версией огнелиса.

Если не жалко трафика, и времени. А тратиться и того и другого при обновлении огнелиса будет предостаточно, то рекомендую к использованию <strong>firefox-pgo</strong>!!
