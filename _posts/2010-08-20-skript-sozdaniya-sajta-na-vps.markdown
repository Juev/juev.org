--- 
layout: post
title: !binary |
  0KHQutGA0LjQv9GCINGB0L7Qt9C00LDQvdC40Y8g0YHQsNC50YLQsCDQvdCw
  IFZQUw==

---
В последнее время меня очень напрягает как тормозит мой сайт. Не знаю, что там делают на хостинге, но даже с учетом дополнительно оплаченных денег за апгрейд сервера, данная ситуация никуда не годиться.

Довольно долго выбирал из обширного списка хостера. И постоянно терзала мысль о том, что очень хочется протестировать eaccelerator. Насколько измениться производительность сайта при использовании данной системы кеширования результатов работы php? Ни одна из существующих компаний, предоставляющих услугу шаред-хостинга не предоставляют возможности использования eaccelerator на своих серверах. По крайней мере, пока ни одну не нашел...

Естественно начал думать о VPS, свой сервер, на котором делаешь то, что нужно и так, как
хочешь. С OpenVZ связываться не хотелось, оставался выбор между Virtuozzo и Xen.
Постепенно начал думать только об одной компании - MediaTemple.net. Предоставляют
 продвинутый шаред-хостинг за 20$, vps на virtuozzo от 30$, и дальше по возрастающей. Уже
практически собирался брать, как наткнулся на статью <a title="Permanent Link To Amazon Web Services. Часть 2. Запуск сервера" rel="nofollow" href="http://theapplegeek.ru/archives/1825">Amazon Web Services. Часть 2. Запуск сервера</a>, в комментариях к которой разговорились с автором (Олег Сердюков). И он указал на то, что его сайт работает на VPS от Linode.com (виртуализация Xen), и рекомендует именно его, и по ценам и по надежности очень хороший вариант. Думал я весь день, выбирал, и вскоре заказал себе сервер с 512 мегабайтами памяти.

В качестве веб-сервера было решено использовать связку apache + nginx, которую настраивал по статье <a href="http://blog.ap.kiev.ua/nastrojka-programm/nastrojka-veb-servera-apache2-nginx-na-baze-ubuntu-server/" rel="nofollow">Настройка веб сервера apache2 + nginx на базе Ubuntu server</a>. После чего возник вопрос, как можно упростить сам процесс создания сайтов? Каждый раз прописывать руками конфигурацию неэффективно. По сути все конфигурационные файлы однотипные, мало что там меняется.

Пробовал использовать webmin, ispconf. Последний очень быстро работает и корректно, легко организовать работу сервера по многим параметрам. Но мне не понравилось то, какую структуру каталогов он создает в корневой директории веб-сервера. Продолжил поиски и неожиданно наткнулся на статью <a href="http://wiki.vdsplanet.ru/Vhost_%D0%B4%D0%BB%D1%8F_apache2%2Bnginx_%D0%B2_%D0%BE%D0%B4%D0%BD%D0%BE_%D0%BD%D0%B0%D0%B6%D0%B0%D1%82%D0%B8%D0%B5" rel="nofollow">Vhost для apache2+nginx в одно нажатие</a>, в которой предлагался набор скриптов для создания типового Vhost в связке apache и nginx.

После небольшого разбора оказалось, что скрипты содержат ошибки. Сел и за вечер на их основе создал свои, исправил все ошибки, перенес все файлы в одну директорию, чтобы было проще использовать и переносить. Переписал конфигурацию apache для использования fastcgi (оказалось, что в обычном режиме apache отказывается работать с suexec), подготовил скрипты для использования php в режиме обычного cgi (подключать пока руками). Единственно, не стал делать проверку на вводимые данные, пока все это лежит на плечах того, кто использует скрипты.

Скрипта всего два:
<ol>
	<li>a2addvr - используется для добавления виртуального хоста</li>
	<li>a2delvr - используется для удаления виртуального хоста</li>
</ol>
Для первого скрипта используется следующий синтаксис:

    a2addvr domain.ru user

Где domain.ru - домен, который добавляем и user - имя существующего пользователя, который будет владельцем всех файлов виртуального хоста. Оба параметра обязательны и не проверяются. Будьте аккуратны! Пользователь должен быть заранее создан в системе. Перед использованием необходимо отредактировать файл, прописав в начале свой email и ip-адрес сервера, на котором будут располагаться сайты (если email можно оставить в том же значении, то ip-адрес прописывать строго обязательно).

Для второго скрипта используется следующий синтаксис:

    a2delvr domain.ru

Где domain.ru - домен, который удаляется с сервера. При этом не производиться проверка, используется ли данный сайт в apache и nginx. Если он был предварительно отключен администратором, то удаление будет происходить с рядом ошибок. Которые можно просто проигнорировать (не страшно, хотя не приятно). Удаляется только конфигурация apache и nginx, сами файлы виртуального хоста остаются не тронутыми, при необходимости нужно будет удалить их самостоятельно.

Надеюсь мое творение кому-то понадобится!

Скачать файлы в архиве: <a href="http://static.juev.ru/2010/08/a2addvr.tar.gz">a2addvr.tar.gz</a>

Добавлено: в качестве операционной системы использую ubuntu 10.04
