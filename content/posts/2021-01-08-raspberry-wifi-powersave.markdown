---
title: "Raspberry WiFi PowerSave mode"
date: 2021-01-08T17:26:14+0300
image: https://static.juev.org/2020/06/rasp04.jpeg
tags:
  - raspberrypi
  - tips
---
Спустя 18 дней после установки Miniflux на Heroku получил уведомление о том, что использование Postgres базы приближается к пределу и в скором времени база будет переведена в режим только для чтения.

Провел установку Miniflux на миникомпьютер Raspberry PI 4. Но с WiFi все еще возникают проблемы.

## WiFi 5Ghz

Ранее я уже описывал про проблему с использованием сети [5Ghz на Raspberry PI](https://www.juev.org/2020/06/04/raspberrypi-wifi-5ghz/). На тот момент времени использовал решение в виде переключения страны, используемой во встроенном адаптере. Но как оказалось в дальнейшем, решение это не очень хорошее, так как скорость работы была все равно невысокой, и использование другой страны в адаптере оказывало влияние на работу других устройств в сети.

В результате просто отказался от использования сети в 5Ghz и проводил настройку на сеть 2.4Ghz.

## WiFi PowerSave Mode

С настройкой сети в 2.4Ghz проблем не возникало. Но вот в работе фиксировалась скорость порядка 4-6 мегабит. И как раз при использовании Miniflux обратил внимание на то, что сервер порой отвечает с задержкой в несколько секунд.

В сети нашел упоминание про использование внутренним адаптером режима энергосбережения, во время которого адаптер при неиспользовании выключается. И при повторном обращении включается снова, но на включение тратиться несколько драгоценных секунд.

Проверяется это довольно просто:

```bash
$ sudo apt-get install iw
$ /sbin/iw wlan0 get power_save
Power save: on
```

Для отключения достаточно выполнить команду:

```bash
$ sudo /sbin/iwconfig wlan0 power off
$ /sbin/iw wlan0 get power_save
Power save: off
```

Но после перезагрузки устройства режим энергосбережения снова включается. Необходимо было найти способ автоматически запускать данную команду при загрузке устройства. Для этого изменяем файл `/etc/rc.local`, добавляя следующую команду перед строкой `exit 0`:

```bash
/sbin/iwconfig wlan0 power off
```

Теперь при перезагрузке устройства режим энергосбережения будет выключен.

Обратил внимание на то, что скорость интернета так же выросла с 4-6 до 10-11 мегабит в секунду. И задержки при обращении к Miniflux больше себя не проявляли.
