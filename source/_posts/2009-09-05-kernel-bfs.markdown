--- 
layout: post
title: Kernel BFS
keywords: archlix,kernel,bfs,patch
date: 2009-09-05
tags:
  - archlinux
  - kernel

---
Con Kolivas вернулся к разработке ядра и представил новый шедулер BFS.
<blockquote>BFS - это аббревиатура от <em>Brain Fuck Scheduler</em>. Он был разработан по принципу "гляжу только вперёд" и позволяет выжать максимум из достаточно слабых компьютеров, при этом он не ориентирован на суперкомпьютеры. BFS ориентирован на десктоп, имеет при этом по дизайну сверхнизкие задержки для великолепной интерактивности, вместо того, чтобы заниматься подсчётами, при этом BFS имеет настоящую "честность" (распределения процессорного времени), хорошее распределение уровней NICE и отличную масштабируемость при обычных нагрузках.</blockquote>
Начитавшись всего этого очень захотелось его попробовать в работе. Скачал патч, попытался наложить на свое текущее ядро 2.6.30.5 и получил кучу сообщений об ошибках. Пришлось на время оставить эту затею.

И вот сегодня оказалось, что в AUR появился пакет <em>kernel26-bfs</em>, который позволяет собрать ядро с необходимыми патчами. Оказалось так же, что пакет несколько устарел и пытается использовать версию патча, которой уже нет на сервере. Опишу решение данной проблемы.

Во-первых, нам необходимо получить файл <em>PKGBUILD</em>, для этого переходим во временный каталог, созданный специально для сборки ядра и даем команду:

    $ yaourt -G kernel26-bfs

После чего в текущем каталоге окажутся несколько файлов. Нам нужно будет изменить только
<em>PKGBUILD</em>. Для этого заходим на страницу <a href="http://ck.kolivas.org/patches/bfs/" rel="nofollow">ck.kolivas.org</a> и смотрим версию патча, который будет представлен на день сборки. В моем случае это был файл <em>2.6.30-sched-bfs-205.patch</em>

Качаем его и смотрим <em>md5</em> сумму:

    $ md5sum 2.6.30-sched-bfs-205.patch

Полученное значение прописываем в соответствующей строке <em>md5sum</em> файла <em>PKGBUILD</em>. И не забываем сменить имя файла в строке <em>source</em>.

Если хотим использовать готовую конфигурацию своего ядра, ее нужно скопировать в текущий каталог и переименовать в <em>config</em>, или <em>config.x86_64</em>, в зависимости от того, какое ядро используется. После чего опять нужно определить значение <em>md5sum</em> для данного файла и прописать его в соответствующей строке файла <em>PKGBUILD</em>.

Теперь можно заняться самой сборкой, для этого в текущем каталоге даем команду:

    $ makepkg

На что будут скачаны исходники ядра 2.6.30, необходимые патчи и начнется сама сборка. По прошествии немного времени в текущем каталоге появиться файл пакета, который можно будет устанавливать:

    $ yaourt -U kernel26-bfs-2.6.30.5-1-i686.pkg.tar.gz

Осталось только изменить настройки grub для использования данного ядра при загрузке системы и можно начинать эксперименты.

Что могу сказать? Ядро получается более отзывчивым, чем обычно. Работать очень приятно. Но не обошлось и без проблем. После перезагрузки сервера <em>xorg</em> у меня прекращали работать все оболочки. Ни в иксовых терминалах, ни в консоли не запускались ни <em>bash</em>, ни <em>zsh</em>... А спустя некоторое время зависал и сам сервер <em>xorg</em>...

Проблема решается только жесткой перезагрузкой компьютера. Возможно это только моя частная проблема, так как я использовал конфиг ядра не из пакета, а свой собственный, который использую уже на протяжении нескольких месяцев...

Попробую еще поэкспериментировать с данным патчем. А пока ждем официального релиза!

Проект очень интересный, и на мой взгляд, имеет право на жизнь.
